
# 用户界面设计

<cite>
**本文档中引用的文件**
- [popup.html](file://chrome-extension/popup.html)
- [popup.js](file://chrome-extension/popup.js)
- [netscope.html](file://netscope.html)
- [messages.json](file://chrome-extension/_locales/en/messages.json)
- [messages.json](file://chrome-extension/_locales/zh_CN/messages.json)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构](#项目结构)
3. [核心组件](#核心组件)
4. [架构概述](#架构概述)
5. [详细组件分析](#详细组件分析)
6. [依赖关系分析](#依赖关系分析)
7. [性能考虑](#性能考虑)
8. [故障排除指南](#故障排除指南)
9. [结论](#结论)

## 简介
本项目包含两个主要用户界面：Chrome扩展弹出窗口（popup.html）和独立版网络监控工具（netscope.html）。两者都提供网络请求监控功能，但使用场景和功能范围有所不同。弹出窗口作为浏览器扩展的一部分，专注于当前标签页的监控；而独立版提供更完整的网页嵌入式监控体验。

## 项目结构

```mermaid
graph TB
subgraph "Chrome扩展"
popup[popup.html]
popupjs[popup.js]
manifest[manifest.json]
background[background.js]
locales[_locales/]
end
netscope[netscope.html]
popup --> popupjs
popup --> locales
netscope --> popupjs
```

**图示来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)
- [netscope.html](file://netscope.html#L1-L799)

**章节来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)
- [netscope.html](file://netscope.html#L1-L799)

## 核心组件

该系统的核心UI组件包括控制按钮、统计数据显示区域和域名列表容器。这些组件在两种界面中都有实现，但布局和功能有所差异。弹出窗口采用紧凑型设计，适合快速访问；而独立版提供更丰富的数据展示和交互功能。

**章节来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)
- [netscope.html](file://netscope.html#L1-L799)

## 架构概述

```mermaid
graph TD
A[用户界面] --> B{界面类型}
B --> C[Chrome扩展弹出窗口]
B --> D[独立版应用]
C --> E[控制按钮]
C --> F[统计数据]
C --> G[域名列表]
D --> H[URL输入]
D --> I[控制按钮]
D --> J[多维度统计]
D --> K[域名侧边栏]
D --> L[请求详情]
M[国际化支持] --> C
M --> D
N[响应式设计] --> C
N --> D
```

**图示来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)
- [netscope.html](file://netscope.html#L1-L799)

## 详细组件分析

### 弹出窗口分析

#### 结构布局
弹出窗口采用垂直布局，从上到下依次为：标题区、状态指示器、控制按钮区、统计卡片区和域名列表区。这种布局优化了有限的空间利用，确保关键功能易于访问。

```mermaid
flowchart TD
Header["头部区域\n(标题 + 语言切换)"]
Status["状态指示器"]
Controls["控制按钮组\n(开始/停止/导出/清除)"]
Stats["统计卡片\n(总请求数/域名数)"]
DomainList["域名列表容器"]
Header --> Status
Status --> Controls
Controls --> Stats
Stats --> DomainList
```

**图示来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)

**章节来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)

#### 视觉元素与样式
CSS样式实现了现代化的视觉效果，包括渐变背景、圆角按钮和阴影效果。响应式设计确保在不同设备上的良好显示，通过固定宽度（400px）和最小高度（500px）来保证可用性。

```mermaid
classDiagram
class VisualElements {
+gradient header background
+rounded buttons
+card-based stats
+scrollable domain list
+status indicators
+language switcher
}
```

**图示来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)

#### 交互行为
JavaScript通过事件监听器实现按钮功能，动态更新DOM内容。状态转换机制清晰地反映了监控状态的变化，从"准备就绪"到"正在监控"再到"已停止"。

```mermaid
sequenceDiagram
participant User as 用户
participant UI as 界面
participant JS as popup.js
User->>UI : 点击"开始监控"
UI->>JS : 触发startMonitoring()
JS->>JS : 发送消息给background.js
JS->>UI : 更新UI状态
UI-->>User : 显示"正在监控..."
User->>UI : 点击"停止监控"
UI->>JS : 触发stopMonitoring()
JS->>JS : 发送消息给background.js
JS->>UI : 更新UI状态
UI-->>User : 显示"监控已停止"
```

**图示来源**
- [popup.js](file://chrome-extension/popup.js#L1-L255)
- [popup.html](file://chrome-extension/popup.html#L1-L236)

**章节来源**
- [popup.js](file://chrome-extension/popup.js#L1-L255)

### 独立版应用分析

#### 扩展版与独立版对比
虽然两个界面共享相似的设计语言和核心功能，但在UI上有显著差异。独立版提供了URL输入框、更详细的统计信息、分栏布局以及内嵌iframe显示被监控页面。

```mermaid
graph TD
subgraph 共同特征
A[渐变标题背景]
B[语言切换器]
C[开始/停止按钮]
D[导出/清除功能]
E[域名列表]
end
subgraph 弹出窗口特有
F[紧凑垂直布局]
G[仅监控当前标签]
H[简单统计卡片]
end
subgraph 独立版特有
I[URL输入框]
J[分栏布局]
K[内嵌浏览器]
L[详细请求列表]
M[多种导出选项]
N[资源类型统计]
end
A --> P((设计一致性))
B --> P
C --> P
D --> P
E --> P
```

**图示来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)
- [netscope.html](file://netscope.html#L1-L799)

**章节来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)
- [netscope.html](file://netscope.html#L1-L799)

#### 内容刷新机制
JavaScript通过PerformanceObserver API捕获网络请求，并实时更新UI。数据流从底层监控到前端展示形成了闭环，确保用户看到的是最新信息。

```mermaid
flowchart LR
A[PerformanceObserver] --> |捕获请求| B[NetworkMonitor]
B --> |存储数据| C[requests数组]
C --> |按域名分组| D[domains Map]
D --> |排序处理| E[renderDomainList()]
E --> |更新DOM| F[域名列表]
D --> |计算统计| G[updateUI()]
G --> |更新元素| H[统计数值]
```

**图示来源**
- [netscope.html](file://netscope.html#L1-L799)

### UI状态转换说明

#### 监控状态变化
界面根据监控状态进行动态调整，体现了清晰的状态管理模式。初始状态下显示"准备就绪"，开始监控后变为"正在监控..."，并隐藏开始按钮显示停止按钮。

```mermaid
stateDiagram-v2
[*] --> Idle
Idle --> Monitoring : 开始监控
Monitoring --> Idle : 停止监控
Monitoring --> DataAvailable : 捕获到请求
DataAvailable --> ExportReady : 数据存在
ExportReady --> Idle : 清除数据
state Idle {
[*] --> Ready
Ready --> DisplayEmptyState
}
state Monitoring {
[*] --> Capturing
Capturing --> UpdateStats
}
```

**图示来源**
- [popup.js](file://chrome-extension/popup.js#L1-L255)
- [netscope.html](file://netscope.html#L1-L799)

**章节来源**
- [popup.js](file://chrome-extension/popup.js#L1-L255)

## 依赖关系分析

```mermaid
graph LR
popup.html --> popup.js
popup.js --> chrome.runtime
popup.js --> chrome.storage
popup.js --> chrome.tabs
netscope.html --> inlineScript
inlineScript --> NetworkMonitor
_locales --> popup.html
_locales --> netscope.html
```

**图示来源**
- [popup.html](file://chrome-extension/popup.html#L1-L236)
- [popup.js](file://chrome-extension/popup.js#L1-L255)
- [netscope.html](file://netscope.html#L1-L799)

**章节来源**
- [popup.js](file://chrome-extension/popup.js#L1-L255)

## 性能考虑
两个界面都采用了轻量级的设计理念，避免不必要的重绘和布局抖动。弹出窗口限制了最大高度以防止遮挡过多屏幕空间，而独立版使用虚拟滚动的概念（通过overflow-y:auto）来处理大量域名数据。

## 故障排除指南

### 常见问题
当用户遇到界面不更新或功能失效时，可能的原因包括：
-