<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetScope - Network Request Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .lang-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 5px;
            display: flex;
            gap: 5px;
        }
        
        .lang-btn {
            padding: 5px 15px;
            background: transparent;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .lang-btn.active {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .controls {
            padding: 20px 30px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .url-input {
            flex: 1;
            min-width: 300px;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .url-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .stats {
            padding: 20px 30px;
            background: #f9fafb;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            flex: 1;
            min-width: 150px;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            color: #1f2937;
            font-size: 24px;
            font-weight: 700;
        }
        
        .content {
            display: flex;
            height: 500px;
        }
        
        .sidebar {
            width: 300px;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
            background: #fafafa;
        }
        
        .sidebar h3 {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            font-size: 16px;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        
        .domain-item {
            padding: 12px 20px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .domain-item:hover {
            background: #f3f4f6;
        }
        
        .domain-item.active {
            background: #ede9fe;
            border-left: 3px solid #667eea;
        }
        
        .domain-name {
            font-size: 14px;
            color: #1f2937;
            word-break: break-all;
        }
        
        .domain-count {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .request-item {
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
        }
        
        .request-url {
            color: #1f2937;
            font-size: 13px;
            word-break: break-all;
            margin-bottom: 8px;
        }
        
        .request-info {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #6b7280;
        }
        
        .tag {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .tag-xhr { background: #dbeafe; color: #1e40af; }
        .tag-script { background: #fef3c7; color: #92400e; }
        .tag-stylesheet { background: #d1fae5; color: #065f46; }
        .tag-image { background: #fce7f3; color: #9f1239; }
        .tag-font { background: #e9d5ff; color: #6b21a8; }
        .tag-document { background: #f3f4f6; color: #374151; }
        .tag-other { background: #fee2e2; color: #991b1b; }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .iframe-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }
        
        .iframe-container.active {
            display: block;
        }
        
        .iframe-wrapper {
            position: absolute;
            top: 50px;
            left: 50px;
            right: 50px;
            bottom: 50px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .iframe-header {
            padding: 15px 20px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        iframe {
            flex: 1;
            width: 100%;
            border: none;
        }
        
        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .export-modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #1f2937;
        }
        
        .domain-list {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="lang-switcher">
                <button class="lang-btn active" onclick="setLanguage('en')">EN</button>
                <button class="lang-btn" onclick="setLanguage('zh')">‰∏≠Êñá</button>
            </div>
            <h1>üåê NetScope</h1>
            <p class="i18n" data-key="subtitle">Real-time network request monitoring and domain analysis tool</p>
        </div>
        
        <div class="controls">
            <input type="text" class="url-input" id="urlInput" placeholder="Enter URL to monitor, e.g., https://example.com">
            <button class="btn-primary" id="startMonitor"><span class="i18n" data-key="startMonitor">Start Monitoring</span></button>
            <button class="btn-secondary" id="exportDomains"><span class="i18n" data-key="exportDomains">Export Domains</span></button>
            <button class="btn-danger" id="clearData"><span class="i18n" data-key="clearData">Clear Data</span></button>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-label i18n" data-key="totalRequests">Total Requests</div>
                <div class="stat-value" id="totalRequests">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label i18n" data-key="domainCount">Domain Count</div>
                <div class="stat-value" id="domainCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label i18n" data-key="resourceTypes">Resource Types</div>
                <div class="stat-value" id="resourceTypes">0</div>
            </div>
        </div>
        
        <div class="content">
            <div class="sidebar">
                <h3 class="i18n" data-key="domainList">Domain List</h3>
                <div id="domainList"></div>
            </div>
            <div class="main-content" id="requestList">
                <div class="empty-state">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    <p class="i18n" data-key="emptyState">Click "Start Monitoring" to begin capturing network requests</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="iframe-container" id="iframeContainer">
        <div class="iframe-wrapper">
            <div class="iframe-header">
                <span><span class="i18n" data-key="monitoring">Monitoring</span>: <strong id="monitoringUrl"></strong></span>
                <button class="btn-danger" id="stopMonitor"><span class="i18n" data-key="stopMonitor">Stop Monitoring</span></button>
            </div>
            <iframe id="targetFrame"></iframe>
        </div>
    </div>
    
    <div class="export-modal" id="exportModal">
        <div class="modal-content">
            <h3 class="modal-title i18n" data-key="exportTitle">Domain List (Deduplicated)</h3>
            <div class="domain-list" id="exportList"></div>
            <div class="modal-actions">
                <button class="btn-secondary" id="copyToClipboard"><span class="i18n" data-key="copyClipboard">Copy to Clipboard</span></button>
                <button class="btn-primary" id="downloadJson"><span class="i18n" data-key="downloadJson">Download JSON</span></button>
                <button class="btn-secondary" id="closeModal"><span class="i18n" data-key="close">Close</span></button>
            </div>
        </div>
    </div>
    
    <script>
        // Language translations
        const translations = {
            en: {
                subtitle: "Real-time network request monitoring and domain analysis tool",
                startMonitor: "Start Monitoring",
                exportDomains: "Export Domains",
                clearData: "Clear Data",
                totalRequests: "Total Requests",
                domainCount: "Domain Count",
                resourceTypes: "Resource Types",
                domainList: "Domain List",
                emptyState: "Click 'Start Monitoring' to begin capturing network requests",
                monitoring: "Monitoring",
                stopMonitor: "Stop Monitoring",
                exportTitle: "Domain List (Deduplicated)",
                copyClipboard: "Copy to Clipboard",
                downloadJson: "Download JSON",
                close: "Close",
                enterUrl: "Enter URL to monitor, e.g., https://example.com",
                invalidUrl: "Please enter a valid URL",
                noData: "No data to export",
                copied: "Domain list copied to clipboard",
                confirmClear: "Are you sure you want to clear all data?"
            },
            zh: {
                subtitle: "ÂÆûÊó∂ÁõëÊéßÁΩëÈ°µËÆøÈóÆËøáÁ®ã‰∏≠ÁöÑÊâÄÊúâÁΩëÁªúËØ∑Ê±ÇÔºåÁªüËÆ°Âπ∂ÂàÜÊûêÂüüÂêç‰ø°ÊÅØ",
                startMonitor: "ÂºÄÂßãÁõëÊéß",
                exportDomains: "ÂØºÂá∫ÂüüÂêç",
                clearData: "Ê∏ÖÈô§Êï∞ÊçÆ",
                totalRequests: "ÊÄªËØ∑Ê±ÇÊï∞",
                domainCount: "ÂüüÂêçÊï∞Èáè",
                resourceTypes: "ËµÑÊ∫êÁ±ªÂûã",
                domainList: "ÂüüÂêçÂàóË°®",
                emptyState: "ÁÇπÂáª"ÂºÄÂßãÁõëÊéß"ÊåâÈíÆÂºÄÂßãÊçïËé∑ÁΩëÁªúËØ∑Ê±Ç",
                monitoring: "Ê≠£Âú®ÁõëÊéß",
                stopMonitor: "ÂÅúÊ≠¢ÁõëÊéß",
                exportTitle: "ÂüüÂêçÂàóË°®ÔºàÂéªÈáçÂêéÔºâ",
                copyClipboard: "Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø",
                downloadJson: "‰∏ãËΩΩ JSON",
                close: "ÂÖ≥Èó≠",
                enterUrl: "ËæìÂÖ•Ë¶ÅÁõëÊéßÁöÑÁΩëÂùÄÔºå‰æãÂ¶Ç: https://example.com",
                invalidUrl: "ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÁΩëÂùÄ",
                noData: "ÊöÇÊó†Êï∞ÊçÆÂèØÂØºÂá∫",
                copied: "ÂüüÂêçÂàóË°®Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø",
                confirmClear: "Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆÂêóÔºü"
            }
        };
        
        let currentLang = 'en';
        
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('netscope-lang', lang);
            
            // Update language switcher buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(lang) || 
                                              (lang === 'zh' && btn.textContent === '‰∏≠Êñá'));
            });
            
            // Update all i18n elements
            document.querySelectorAll('.i18n').forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholder
            document.getElementById('urlInput').placeholder = translations[lang].enterUrl;
        }
        
        class NetworkMonitor {
            constructor() {
                this.requests = [];
                this.domains = new Map();
                this.selectedDomain = null;
                this.isMonitoring = false;
                this.initElements();
                this.bindEvents();
                
                // Load saved language preference
                const savedLang = localStorage.getItem('netscope-lang') || 'en';
                setLanguage(savedLang);
            }
            
            initElements() {
                this.urlInput = document.getElementById('urlInput');
                this.startBtn = document.getElementById('startMonitor');
                this.exportBtn = document.getElementById('exportDomains');
                this.clearBtn = document.getElementById('clearData');
                this.stopBtn = document.getElementById('stopMonitor');
                this.iframe = document.getElementById('targetFrame');
                this.iframeContainer = document.getElementById('iframeContainer');
                this.domainList = document.getElementById('domainList');
                this.requestList = document.getElementById('requestList');
                this.totalRequestsEl = document.getElementById('totalRequests');
                this.domainCountEl = document.getElementById('domainCount');
                this.resourceTypesEl = document.getElementById('resourceTypes');
                this.monitoringUrlEl = document.getElementById('monitoringUrl');
                this.exportModal = document.getElementById('exportModal');
                this.exportList = document.getElementById('exportList');
            }
            
            bindEvents() {
                this.startBtn.addEventListener('click', () => this.startMonitoring());
                this.stopBtn.addEventListener('click', () => this.stopMonitoring());
                this.clearBtn.addEventListener('click', () => this.clearData());
                this.exportBtn.addEventListener('click', () => this.showExportModal());
                
                document.getElementById('closeModal').addEventListener('click', () => {
                    this.exportModal.classList.remove('active');
                });
                
                document.getElementById('copyToClipboard').addEventListener('click', () => {
                    this.copyDomainsToClipboard();
                });
                
                document.getElementById('downloadJson').addEventListener('click', () => {
                    this.downloadDomainsJson();
                });
                
                this.urlInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.startMonitoring();
                    }
                });
            }
            
            startMonitoring() {
                const url = this.urlInput.value.trim();
                if (!url) {
                    alert(translations[currentLang].enterUrl);
                    return;
                }
                
                try {
                    new URL(url);
                } catch (e) {
                    alert(translations[currentLang].invalidUrl);
                    return;
                }
                
                this.isMonitoring = true;
                this.monitoringUrlEl.textContent = url;
                this.iframeContainer.classList.add('active');
                
                this.setupProxy();
                this.iframe.src = url;
            }
            
            stopMonitoring() {
                this.isMonitoring = false;
                this.iframeContainer.classList.remove('active');
                this.iframe.src = '';
            }
            
            setupProxy() {
                if (this.observer) {
                    this.observer.disconnect();
                }
                
                this.observer = new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (entry.entryType === 'resource' || entry.entryType === 'navigation') {
                            this.captureRequest(entry);
                        }
                    }
                });
                
                this.observer.observe({ entryTypes: ['resource', 'navigation'] });
                
                const originalFetch = window.fetch;
                window.fetch = (...args) => {
                    const url = args[0];
                    this.captureRequest({ name: url, initiatorType: 'fetch' });
                    return originalFetch.apply(this, args);
                };
                
                const originalOpen = XMLHttpRequest.prototype.open;
                XMLHttpRequest.prototype.open = function(method, url) {
                    this.addEventListener('load', () => {
                        if (this.monitor) {
                            this.monitor.captureRequest({ name: url, initiatorType: 'xmlhttprequest' });
                        }
                    });
                    this.monitor = this;
                    return originalOpen.apply(this, arguments);
                };
            }
            
            captureRequest(entry) {
                if (!this.isMonitoring) return;
                
                const url = entry.name || entry.url;
                if (!url) return;
                
                try {
                    const urlObj = new URL(url);
                    const domain = urlObj.hostname;
                    
                    const request = {
                        url: url,
                        domain: domain,
                        type: this.getResourceType(entry.initiatorType),
                        timestamp: Date.now()
                    };
                    
                    this.requests.push(request);
                    
                    if (!this.domains.has(domain)) {
                        this.domains.set(domain, []);
                    }
                    this.domains.get(domain).push(request);
                    
                    this.updateUI();
                } catch (e) {
                    // Ignore invalid URLs
                }
            }
            
            getResourceType(initiatorType) {
                const typeMap = {
                    'xmlhttprequest': 'XHR',
                    'fetch': 'XHR',
                    'script': 'Script',
                    'css': 'Stylesheet',
                    'link': 'Stylesheet',
                    'img': 'Image',
                    'image': 'Image',
                    'font': 'Font',
                    'navigation': 'Document',
                    'iframe': 'Document',
                    'other': 'Other'
                };
                return typeMap[initiatorType] || 'Other';
            }
            
            updateUI() {
                this.totalRequestsEl.textContent = this.requests.length;
                this.domainCountEl.textContent = this.domains.size;
                
                const types = new Set(this.requests.map(r => r.type));
                this.resourceTypesEl.textContent = types.size;
                
                this.renderDomainList();
                this.renderRequestList();
            }
            
            renderDomainList() {
                const sortedDomains = Array.from(this.domains.entries())
                    .sort((a, b) => b[1].length - a[1].length);
                
                this.domainList.innerHTML = sortedDomains.map(([domain, requests]) => `
                    <div class="domain-item" data-domain="${domain}">
                        <span class="domain-name">${domain}</span>
                        <span class="domain-count">${requests.length}</span>
                    </div>
                `).join('');
                
                this.domainList.querySelectorAll('.domain-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const domain = item.dataset.domain;
                        this.selectDomain(domain);
                    });
                });
            }
            
            selectDomain(domain) {
                this.selectedDomain = domain;
                
                this.domainList.querySelectorAll('.domain-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.domain === domain);
                });
                
                this.renderRequestList(domain);
            }
            
            renderRequestList(domain = null) {
                const requests = domain ? this.domains.get(domain) : this.requests;
                
                if (!requests || requests.length === 0) {
                    this.requestList.innerHTML = `
                        <div class="empty-state">
                            <p class="i18n" data-key="emptyState">${translations[currentLang].emptyState}</p>
                        </div>
                    `;
                    return;
                }
                
                this.requestList.innerHTML = requests.map(request => {
                    const typeClass = `tag-${request.type.toLowerCase()}`;
                    return `
                        <div class="request-item">
                            <div class="request-url">${request.url}</div>
                            <div class="request-info">
                                <span class="tag ${typeClass}">${request.type}</span>
                                <span>${new Date(request.timestamp).toLocaleTimeString()}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            clearData() {
                if (confirm(translations[currentLang].confirmClear)) {
                    this.requests = [];
                    this.domains.clear();
                    this.selectedDomain = null;
                    this.updateUI();
                }
            }
            
            showExportModal() {
                if (this.domains.size === 0) {
                    alert(translations[currentLang].noData);
                    return;
                }
                
                const domainList = Array.from(this.domains.keys()).sort();
                this.exportList.textContent = domainList.join('\n');
                this.exportModal.classList.add('active');
            }
            
            copyDomainsToClipboard() {
                const domainList = Array.from(this.domains.keys()).sort().join('\n');
                navigator.clipboard.writeText(domainList).then(() => {
                    alert(translations[currentLang].copied);
                });
            }
            
            downloadDomainsJson() {
                const data = {
                    domains: Array.from(this.domains.keys()).sort(),
                    statistics: {
                        totalDomains: this.domains.size,
                        totalRequests: this.requests.length,
                        timestamp: new Date().toISOString()
                    },
                    details: Array.from(this.domains.entries()).map(([domain, requests]) => ({
                        domain: domain,
                        requestCount: requests.length,
                        types: [...new Set(requests.map(r => r.type))]
                    }))
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `netscope-domains-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        // Initialize monitor
        const monitor = new NetworkMonitor();
        
        console.log('%cNetScope - Network Request Monitor', 'color: #667eea; font-size: 14px; font-weight: bold;');
        console.log('%cNote: Due to browser security restrictions, some cross-origin requests may not be captured', 'color: #f59e0b; font-size: 12px;');
        console.log('%cFor comprehensive monitoring, use the Chrome DevTools Network panel', 'color: #6b7280; font-size: 12px;');
    </script>
</body>
</html>